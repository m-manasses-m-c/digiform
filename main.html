<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Question√°rio 4 √Åreas ‚Üí 46 Perfis (com hist√≥rico + Digimon)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#06b6d4;
    --good:#22c55e; --bad:#ef4444; --warn:#f59e0b; --neutral:#64748b;
  }
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;line-height:1.45}
  header{padding:24px 16px;background:linear-gradient(90deg,#0ea5e9,#7c3aed);color:white}
  header h1{margin:0 0 8px;font-size:22px}
  header p{margin:0;opacity:.9}
  main{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid #1f2937;border-radius:12px;margin:16px 0;overflow:hidden}
  .card h2{margin:0;padding:14px 16px;border-bottom:1px solid #1f2937;font-size:18px;background:#0b1220}
  .card .body{padding:12px 16px}
  .q{margin:12px 0;padding:8px 10px;border:1px solid #1f2937;border-radius:10px}
  .q label{display:block;margin-bottom:8px;font-weight:600}
  .likert{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
  .likert .scale{display:flex;gap:6px;align-items:center}
  .likert input[type=range]{width:100%}
  .hint{color:var(--muted);font-size:12px;margin-top:2px}
  .actions{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 16px}
  button{background:linear-gradient(180deg,#0ea5e9,#2563eb);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  button.secondary{background:#334155}
  button.ghost{background:transparent;border:1px solid #334155;color:#cbd5e1}
  .grid{display:grid;gap:12px}
  @media(min-width:900px){ .grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:1fr 1fr 1fr} }
  .meter{height:18px;background:#0b1220;border:1px solid #1f2937;border-radius:999px;position:relative;overflow:hidden}
  .meter .fill{height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4);width:0%}
  .meter .center{position:absolute;left:50%;top:0;bottom:0;width:2px;background:#1f2937;opacity:.8}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .tag{display:inline-block;background:#0b1220;border:1px solid #1f2937;border-radius:999px;padding:2px 8px;margin-right:6px;font-size:12px;color:#cbd5e1}
  .muted{color:var(--muted)}
  .result-title{font-size:22px;margin:6px 0}
  .desc{color:#d1d5db}
  .small{font-size:12px;color:#9ca3af}
  footer{padding:16px;color:#94a3b8;text-align:center}
  ul.tight{margin:8px 0 0 18px;padding:0}
  ul.tight li{margin:4px 0}
  details summary{cursor:pointer}
  .axis-card{padding:8px 10px;border:1px solid #1f2937;border-radius:10px}
  .axis-title{font-weight:700}
  .axis-sub{color:#9ca3af;font-size:12px;margin-top:2px}
  .digimon-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid #334155;background:#0b1220}
</style>
</head>
<body>
<header>
  <h1>Question√°rio amplo: Ideologia ‚Ä¢ Pol√≠tica ‚Ä¢ Personalidade ‚Ä¢ Filosofia</h1>
  <p>Responda 48 afirma√ß√µes (1‚Äì5). O script calcula automaticamente e classifica voc√™ em 1 de 46 perfis, salva hist√≥rico e sugere um Digimon correspondente.</p>
</header>

<main>
  <div class="card">
    <h2>Instru√ß√µes</h2>
    <div class="body">
      <ul>
        <li>Escala 1‚Äì5: 1 = Discordo totalmente; 3 = Neutro; 5 = Concordo totalmente.</li>
        <li>Todas as quest√µes come√ßam em ‚Äú3‚Äù (neutro). Ajuste conforme sua vis√£o.</li>
        <li>Clique ‚ÄúCalcular meu perfil‚Äù. Voc√™ ver√° os eixos normalizados, o perfil, as correntes filos√≥ficas e o Digimon correspondente.</li>
      </ul>
      <div class="actions">
        <button id="btnRandom">Aleatorizar respostas</button>
        <button class="secondary" id="btnNeutral">Resetar para Neutro (3)</button>
        <label class="tag" style="cursor:pointer">
          <input type="checkbox" id="chkAutoSave" style="vertical-align:middle;margin-right:6px"> Salvar automaticamente cada c√°lculo
        </label>
      </div>
      <div class="small">Auto-save: ativado por padr√£o. Os registros ficam no seu navegador (localStorage).</div>
    </div>
  </div>

  <form id="quizForm">
    <div id="questions"></div>
    <div class="card">
      <div class="body">
        <div class="actions">
          <button type="button" id="btnCalc">Calcular meu perfil</button>
          <button type="button" class="ghost" id="btnExport">Exportar resultado (JSON)</button>
        </div>
        <div class="small">Privacidade: tudo acontece no seu navegador (sem envio a servidores).</div>
      </div>
    </div>
  </form>

  <div id="results" class="card" style="display:none">
    <h2>Resultados</h2>
    <div class="body">
      <div id="profileBlock"></div>
      <div class="actions">
        <button type="button" id="btnSaveHistory">Salvar no hist√≥rico</button>
      </div>
      <hr style="border-color:#1f2937;margin:16px 0">
      <h3>Eixos (normalizados)</h3>
      <div id="axesGrid" class="grid cols-2"></div>
      <hr style="border-color:#1f2937;margin:16px 0">
      <h3>Top 3 correntes filos√≥ficas</h3>
      <div id="topCurrents" class="grid cols-3"></div>
      <details style="margin-top:12px">
        <summary>Ver todas as correntes</summary>
        <div id="allCurrents" class="grid cols-3" style="margin-top:8px"></div>
      </details>
    </div>
  </div>

  <div id="historyCard" class="card">
    <h2>Hist√≥rico de resultados</h2>
    <div class="body">
      <div class="actions">
        <button type="button" class="ghost" id="btnExportHistory">Exportar hist√≥rico (JSON)</button>
        <button type="button" class="secondary" id="btnClearHistory">Limpar hist√≥rico</button>
      </div>
      <div id="historyList" class="grid cols-2"></div>
      <div id="historyEmpty" class="small" style="display:none">Sem registros ainda. Calcule um perfil e clique ‚ÄúSalvar no hist√≥rico‚Äù.</div>
    </div>
  </div>

  <div id="debug" class="card" style="display:none">
    <h2>Debug</h2>
    <div class="body">
      <pre id="debugPre" style="white-space:pre-wrap"></pre>
    </div>
  </div>
</main>

<script>
/*
  Atualiza√ß√µes:
  - Agora s√£o 48 enunciados: 12 por se√ß√£o (Ideologia, Pol√≠tica, Personalidade e Filosofia).
  - T√≠tulo e subt√≠tulo em cada eixo normalizado.
  - Auto-save ativado por padr√£o.
  - Digimon para cada um dos 46 perfis com justificativa.
*/

/* ----------------------------- Data: Items ----------------------------- */
const items = [
  // Ideologia (I1..I12)
  {code:'I1', group:'Ideologia', text:'Diante de duas reformas, prefiro a que diminui disparidades entre grupos mesmo que o avan√ßo produtivo seja mais lento.', type:'dir',
    axes:{Ecom:12, Cult:8}, currents:{}},
  {code:'I2', group:'Ideologia', text:'Autoridades s√≥ devem limitar escolhas pessoais quando houver dano concreto a terceiros.', type:'dir',
    axes:{Autor:12, Ecom:-6}, currents:{}},
  {code:'I3', group:'Ideologia', text:'Costumes herdados e lideran√ßa espiritual oferecem uma moldura moral mais confi√°vel que experimentos sociais.', type:'dir',
    axes:{Cult:-12, Orto:12, Etica:8}, currents:{DE:8, OR:10}},
  {code:'I4', group:'Ideologia', text:'Express√µes culturais novas devem ser incorporadas rapidamente, sem esperar consenso prolongado.', type:'dir',
    axes:{Cult:12}, currents:{}},
  {code:'I5', group:'Ideologia', text:'A distribui√ß√£o de oportunidades deve refletir desempenho e esfor√ßo mais do que origem ou contexto.', type:'dir',
    axes:{Ecom:-10}, currents:{}},
  {code:'I6', group:'Ideologia', text:'Normas comuns precisam acomodar estilos de vida minorit√°rios sem exigir justificativas extras.', type:'dir',
    axes:{Cult:12}, currents:{}},
  {code:'I7', group:'Ideologia', text:'Prefiro solu√ß√µes com liberdade de escolha e competi√ß√£o a arranjos √∫nicos conduzidos centralmente.', type:'dir',
    axes:{Ecom:-12, Autor:8}, currents:{}},
  {code:'I8', group:'Ideologia', text:'Quando um grupo precisa decidir, valorizo arranjos de cuidado m√∫tuo mesmo que reduzam graus de autonomia individual.', type:'uni',
    axes:{Ecom:10, Virt:6}, currents:{VI:6}},
  {code:'I9', group:'Ideologia', text:'Algumas a√ß√µes s√£o simplesmente erradas, independentemente de seus resultados.', type:'dir',
    axes:{Etica:12}, currents:{DE:10}},
  {code:'I10', group:'Ideologia', text:'Considero civilizado garantir um piso de dignidade financiado coletivamente, ainda que custe caro.', type:'dir',
    axes:{Ecom:12}, currents:{}},
  {code:'I11', group:'Ideologia', text:'Regras fortes de propriedade e de contrato s√£o a melhor defesa contra abusos, inclusive do poder p√∫blico.', type:'dir',
    axes:{Ecom:-12, Autor:6}, currents:{}},
  {code:'I12', group:'Ideologia', text:'Vejo valor em resguardar h√°bitos locais e express√µes nacionais contra press√µes uniformizantes globais.', type:'dir',
    axes:{Cult:-12, Glob:-10}, currents:{}},

  // Pol√≠tica (P1..P12)
  {code:'P1', group:'Pol√≠tica', text:'Quem mais se beneficia do sistema deve contribuir proporcionalmente mais para financi√°-lo.', type:'dir',
    axes:{Ecom:12}, currents:{}},
  {code:'P2', group:'Pol√≠tica', text:'Em setores de alto risco, prefiro limites firmes definidos pelo regulador, mesmo que restrinjam escolhas.', type:'dir',
    axes:{Autor:-12}, currents:{}},
  {code:'P3', group:'Pol√≠tica', text:'√Åreas cr√≠ticas (energia, defesa, infraestrutura) devem ter dire√ß√£o p√∫blica predominante para evitar vulnerabilidades.', type:'dir',
    axes:{Ecom:12}, currents:{}},
  {code:'P4', group:'Pol√≠tica', text:'Direitos individuais b√°sicos n√£o devem ser sacrificados por prefer√™ncias moment√¢neas da maioria.', type:'dir',
    axes:{Autor:12}, currents:{}},
  {code:'P5', group:'Pol√≠tica', text:'Quando um acordo internacional contraria interesses dom√©sticos essenciais, o pa√≠s deve priorizar sua autonomia.', type:'dir',
    axes:{Glob:-12}, currents:{}},
  {code:'P6', group:'Pol√≠tica', text:'Mistura cultural e chegada de imigrantes tendem a fortalecer o pa√≠s no longo prazo.', type:'dir',
    axes:{Glob:12, Cult:6}, currents:{}},
  {code:'P7', group:'Pol√≠tica', text:'Para manter a ordem, aceito ampliar monitoramento e presen√ßa policial.', type:'dir',
    axes:{Autor:-12}, currents:{}},
  {code:'P8', group:'Pol√≠tica', text:'√â razo√°vel trocar parte do crescimento presente por metas ambientais vinculantes.', type:'dir',
    axes:{Ecom:10, Cult:6}, currents:{}},
  {code:'P9', group:'Pol√≠tica', text:'Em casos extremos, √© leg√≠timo intervir al√©m das fronteiras para proteger vidas e liberdades.', type:'dir',
    axes:{Glob:12}, currents:{}},
  {code:'P10', group:'Pol√≠tica', text:'Obrigatoriedade de voto ajuda a legitimar decis√µes coletivas.', type:'dir',
    axes:{Autor:-8}, currents:{}},
  {code:'P11', group:'Pol√≠tica', text:'Regras fiscais r√≠gidas devem limitar governantes, mesmo em momentos populares.', type:'dir',
    axes:{Ecom:-8}, currents:{}},
  {code:'P12', group:'Pol√≠tica', text:'Medidas tempor√°rias que mudam a competi√ß√£o podem ser justas para corrigir desvantagens hist√≥ricas.', type:'dir',
    axes:{Cult:12, Ecom:6}, currents:{}},

  // Personalidade (N1..N12)
  {code:'N1', group:'Personalidade', text:'Eu me animo explorando ideias incomuns e liga√ß√µes pouco √≥bvias.', type:'uni',
    axes:{O:8}, currents:{}},
  {code:'N2', group:'Personalidade', text:'Transformo planos em listas e cumpro o que prometo.', type:'uni',
    axes:{C:8}, currents:{}},
  {code:'N3', group:'Personalidade', text:'Eventos cheios de gente me reabastecem de energia.', type:'uni',
    axes:{E:8}, currents:{}},
  {code:'N4', group:'Personalidade', text:'Quando h√° conflito, busco pontes antes de posi√ß√µes.', type:'uni',
    axes:{A:8}, currents:{}},
  {code:'N5', group:'Personalidade', text:'Sob press√£o, mantenho a cabe√ßa fria e me recomponho r√°pido.', type:'uni',
    axes:{S:8}, currents:{}},
  {code:'N6', group:'Personalidade', text:'Sou atra√≠do(a) por est√©tica, texturas e experi√™ncias fora do comum.', type:'uni',
    axes:{O:8}, currents:{}},
  {code:'N7', group:'Personalidade', text:'Rotinas e prepara√ß√£o antecipada me deixam √† vontade.', type:'uni',
    axes:{C:8}, currents:{}},
  {code:'N8', group:'Personalidade', text:'Em grupos, costumo puxar a conversa e organizar o andamento.', type:'uni',
    axes:{E:8}, currents:{}},
  {code:'N9', group:'Personalidade', text:'Considero com aten√ß√£o como os outros se sentem antes de decidir.', type:'uni',
    axes:{A:8}, currents:{}},
  {code:'N10', group:'Personalidade', text:'N√£o desisto de metas demoradas; volto a elas at√© concluir.', type:'uni',
    axes:{C:8}, currents:{}},
  {code:'N11', group:'Personalidade', text:'Tenho curiosidade por lugares, sabores e tradi√ß√µes que n√£o conhe√ßo.', type:'uni',
    axes:{O:8}, currents:{}},
  {code:'N12', group:'Personalidade', text:'Falar para muitas pessoas me anima mais do que me aflige.', type:'uni',
    axes:{E:8}, currents:{}},

  // Filosofia (F1..F12)
  {code:'F1', group:'Filosofia', text:'Sem teste e observa√ß√£o, mantenho ceticismo; medi√ß√µes pesam mais que intui√ß√µes.', type:'dir',
    axes:{Epist:-12}, currents:{EM:12, MA:6}},
  {code:'F2', group:'Filosofia', text:'Algumas regras morais valem sempre, ainda quando seria conveniente ignor√°-las.', type:'dir',
    axes:{Etica:12}, currents:{DE:12}},
  {code:'F3', group:'Filosofia', text:'Aceito abrir exce√ß√µes a regras se isso elevar substancialmente o bem-estar de mais gente.', type:'dir',
    axes:{Etica:-12}, currents:{UT:12}},
  {code:'F4', group:'Filosofia', text:'Cultivar car√°ter e h√°bitos virtuosos √© mais importante do que apenas perseguir resultados.', type:'uni',
    axes:{Virt:10}, currents:{VI:12}},
  {code:'F5', group:'Filosofia', text:'Princ√≠pios e estruturas imateriais explicam o mundo de modo mais profundo que as apar√™ncias.', type:'dir',
    axes:{Epist:10}, currents:{PL:12, RA:8}},
  {code:'F6', group:'Filosofia', text:'Mente e consci√™ncia surgem de processos f√≠sicos; n√£o vejo algo al√©m da mat√©ria.', type:'dir',
    axes:{Epist:-8, Orto:-8}, currents:{MA:12}},
  {code:'F7', group:'Filosofia', text:'Liberdade vem junto com ang√∫stia e tarefa de construir sentido.', type:'uni',
    axes:{}, currents:{EX:12}},
  {code:'F8', group:'Filosofia', text:'Na d√∫vida s√©ria, prefiro suspender o ju√≠zo a apostar sem base.', type:'uni',
    axes:{}, currents:{CE:12}},
  {code:'F9', group:'Filosofia', text:'Identifico-me com uma f√© sacramental, trinit√°ria e enraizada na tradi√ß√£o viva.', type:'dir',
    axes:{Orto:14}, currents:{OR:14}},
  {code:'F10', group:'Filosofia', text:'Dom√≠nio de si e serenidade diante do incontrol√°vel s√£o virtudes centrais para mim.', type:'uni',
    axes:{Virt:8, S:4}, currents:{ES:12}},
  {code:'F11', group:'Filosofia', text:'Vejo a comunidade de f√© como um hospital da alma; o mist√©rio se expressa melhor em sil√™ncio que em f√≥rmulas.', type:'dir',
    axes:{Orto:12}, currents:{OR:12}},
  {code:'F12', group:'Filosofia', text:'Dou prioridade √† experi√™ncia vivida bem descrita antes de teorizar sobre ela.', type:'uni',
    axes:{}, currents:{FE:12}},
];

/* -------------------- Render: Questions (range 1..5) ------------------- */
const groupsOrder = ['Ideologia','Pol√≠tica','Personalidade','Filosofia'];
const questionsContainer = document.getElementById('questions');

function renderQuestions(){
  const byGroup = {};
  for(const g of groupsOrder){ byGroup[g] = []; }
  for(const it of items){ if(!byGroup[it.group]) byGroup[it.group]=[]; byGroup[it.group].push(it); }
  const frag = document.createDocumentFragment();
  for(const g of groupsOrder){
    const card = document.createElement('div');
    card.className='card';
    const h2 = document.createElement('h2');
    h2.textContent = g;
    const body = document.createElement('div'); body.className='body';
    for(const it of byGroup[g]){
      const div = document.createElement('div'); div.className='q';
      const label = document.createElement('label');
      label.setAttribute('for', it.code);
      label.textContent = `${it.code}. ${it.text}`;
      const likert = document.createElement('div'); likert.className='likert';
      const left = document.createElement('div'); left.className='muted'; left.textContent='Discordo';
      const right = document.createElement('div'); right.className='muted'; right.textContent='Concordo';
      const scale = document.createElement('div'); scale.className='scale';
      const input = document.createElement('input');
      input.type='range'; input.min='1'; input.max='5'; input.step='1'; input.value='3'; input.id=it.code; input.name=it.code;
      scale.appendChild(input);
      const hint = document.createElement('div'); hint.className='hint'; hint.textContent='1  2  3  4  5';
      likert.append(left, scale, right);
      div.append(label, likert, hint);
      body.appendChild(div);
    }
    card.append(h2, body);
    frag.appendChild(card);
  }
  questionsContainer.innerHTML='';
  questionsContainer.appendChild(frag);
}
renderQuestions();

/* ----------------------- Scoring: Axes & Currents ---------------------- */
const axisNames = ['Ecom','Cult','Autor','Glob','Epist','Etica','Virt','Orto','O','C','E','A','S'];
const axisMeta = {
  Ecom:{type:'dir', title:'Economia', desc:'Estado (+) ‚Üî Mercado (‚àí)'},
  Cult:{type:'dir', title:'Cultura', desc:'Progressista (+) ‚Üî Tradicionalista (‚àí)'},
  Autor:{type:'dir', title:'Autoridade', desc:'Libert√°rio (+) ‚Üî Autorit√°rio (‚àí)'},
  Glob:{type:'dir', title:'Globalismo', desc:'Cosmopolita (+) ‚Üî Nacionalista (‚àí)'},
  Epist:{type:'dir', title:'Epistemologia', desc:'Racionalismo (+) ‚Üî Empirismo (‚àí)'},
  Etica:{type:'dir', title:'√âtica', desc:'Deontologia (+) ‚Üî Consequencialismo (‚àí)'},
  Virt:{type:'uni', title:'Virtudes', desc:'√änfase na √©tica das virtudes (0‚Üí100)'},
  Orto:{type:'dir', title:'Espiritualidade Ortodoxa', desc:'Crist√£o Ortodoxo (+) ‚Üî Secular (‚àí)'},
  O:{type:'uni', title:'Abertura', desc:'Big Five: abertura a experi√™ncias (0‚Üí100)'},
  C:{type:'uni', title:'Conscienciosidade', desc:'Big Five: organiza√ß√£o e disciplina (0‚Üí100)'},
  E:{type:'uni', title:'Extrovers√£o', desc:'Big Five: energia social (0‚Üí100)'},
  A:{type:'uni', title:'Amabilidade', desc:'Big Five: coopera√ß√£o e empatia (0‚Üí100)'},
  S:{type:'uni', title:'Estabilidade Emocional', desc:'Big Five: resili√™ncia (0‚Üí100)'},
};

const currentsList = ['EM','RA','UT','DE','VI','EX','ES','CE','PL','MA','FE','OR'];
const currentsMeta = {
  EM:'Empirismo',
  RA:'Racionalismo',
  UT:'Utilitarismo (Consequencialismo)',
  DE:'Deontologia (Kantismo)',
  VI:'√âtica das Virtudes (Aristotelismo)',
  EX:'Existencialismo',
  ES:'Estoicismo',
  CE:'Ceticismo',
  PL:'Platonismo',
  MA:'Materialismo',
  FE:'Fenomenologia',
  OR:'Cristianismo Ortodoxo'
};

// Max ranges for normalization
const axisMax = {};
const currentsMax = {};
function computeMaxima(){
  for(const a of axisNames){ axisMax[a] = {sumAbs:0, uniMax:0}; }
  for(const c of currentsList){ currentsMax[c] = 0; }
  for(const it of items){
    for(const [a,k] of Object.entries(it.axes||{})){
      if(axisMeta[a].type==='dir'){ axisMax[a].sumAbs += 2*Math.abs(k); }
      else{ axisMax[a].uniMax += 4*k; }
    }
    for(const [c,k] of Object.entries(it.currents||{})){
      currentsMax[c] += 4*k;
    }
  }
}
computeMaxima();

function getResponses(){
  const vals = {};
  for(const it of items){
    const el = document.getElementById(it.code);
    vals[it.code] = parseInt(el.value || '3', 10);
  }
  return vals;
}

function computeScores(responses){
  const rawAxes = Object.fromEntries(axisNames.map(a=>[a,0]));
  const rawCurr = Object.fromEntries(currentsList.map(c=>[c,0]));
  for(const it of items){
    const r = responses[it.code];
    const d = (r - 3); // ‚àí2..+2
    const u = (r - 1); // 0..4
    for(const [a,k] of Object.entries(it.axes||{})){
      if(axisMeta[a].type==='dir'){ rawAxes[a] += d*k; }
      else{ rawAxes[a] += u*k; }
    }
    for(const [c,k] of Object.entries(it.currents||{})){
      rawCurr[c] += u*k;
    }
  }
  const axesNorm = {};
  for(const a of axisNames){
    if(axisMeta[a].type==='dir'){
      const denom = axisMax[a].sumAbs || 1;
      axesNorm[a] = clamp((rawAxes[a]/denom)*100, -100, 100);
    }else{
      const denom = axisMax[a].uniMax || 1;
      axesNorm[a] = clamp((rawAxes[a]/denom)*100, 0, 100);
    }
  }
  const currNorm = {};
  for(const c of currentsList){
    const denom = currentsMax[c] || 1;
    currNorm[c] = clamp((rawCurr[c]/denom)*100, 0, 100);
  }
  return {rawAxes, axesNorm, rawCurr, currNorm};
}
function clamp(x, lo, hi){ return Math.max(lo, Math.min(hi, x)); }

/* ------------------ Profiles (23 bases √ó 2, com explica√ß√µes) ---------- */
const baseProfiles = [
  {code:'B1', name:'Liberal Cosmopolita de Mercado', vec:{Ecom:-70, Cult:50, Autor:70, Glob:70, Orto:-60, O:70, C:55, E:60, A:60, S:60},
    descP:'Liberal cl√°ssico de direitos naturais; pr√≥-mercado, progressista em costumes, libert√°rio e pr√≥-integra√ß√£o global.',
    descG:'Liberal pr√≥-mercado orientado a resultados: regula√ß√µes quando eficazes e pol√≠ticas baseadas em evid√™ncias.',
    expP:[
      'Eixos: mercado forte (‚àíEcom), costumes progressistas (+Cult), liberdades civis (+Autor), cosmopolitismo (+Glob).',
      'Filosofia: deontologia e racionalismo; direitos como princ√≠pios e igualdade perante a lei.',
      'Pol√≠ticas: livre-com√©rcio, regula√ß√£o pr√≥-competi√ß√£o, igualdade civil, migra√ß√£o e inova√ß√£o.'
    ],
    expG:[
      'Mesmos eixos com foco consequencialista e empirista.',
      'Crit√©rio: impacto mensur√°vel no bem-estar e na competi√ß√£o.',
      'Ferramentas: precifica√ß√£o de externalidades, vouchers/testes A/B, avalia√ß√£o de pol√≠ticas.'
    ]},
  {code:'B2', name:'Libert√°rio Localista', vec:{Ecom:-80, Cult:20, Autor:80, Glob:-20, Orto:-40, O:65, C:55, E:55, A:65, S:60},
    descP:'Autonomia individual com √™nfase em comunidades locais e subsidiariedade. N√£o agress√£o e direitos naturais.',
    descG:'Solu√ß√µes volunt√°rias de proximidade; experimenta√ß√£o c√≠vica e empirismo local.',
    expP:[
      'Eixos: mercado (‚àíEcom), libert√°rio (+Autor), localista (Glob levemente ‚àí), cultura moderada (+Cult).',
      'Filosofia: princ√≠pio de n√£o agress√£o, subsidiariedade, confian√ßa em institui√ß√µes locais.',
      'Pol√≠ticas: descentraliza√ß√£o, escolas/sa√∫de com liberdade de escolha, cooperativas e mutualismo.'
    ],
    expG:[
      'Foco no que funciona no munic√≠pio/bairro.',
      'Pilotos e m√©tricas locais, regula√ß√£o leve, arranjos volunt√°rios.',
      'Mercados com governan√ßa comunit√°ria e reputa√ß√£o.'
    ]},
  {code:'B3', name:'Capitalista Social Progressista', vec:{Ecom:-40, Cult:70, Autor:60, Glob:60, Orto:-40, O:75, C:60, E:60, A:65, S:60},
    descP:'Pr√≥-inova√ß√£o, mercado com redes de prote√ß√£o, costumes progressistas. Dignidade, direitos e deveres c√≠vicos.',
    descG:'Pragmatismo regulat√≥rio calibrado por dados, impacto e custo-efetividade.',
    expP:[
      'Eixos: mercado moderado (‚àíEcom) com prote√ß√£o social, progressismo (+Cult), liberdades (+Autor), cosmopolitismo (+Glob).',
      'Filosofia: princ√≠pios de dignidade e justi√ßa aliado √† inova√ß√£o.',
      'Pol√≠ticas: renda m√≠nima/seguro social, competi√ß√£o e direitos civis fortes.'
    ],
    expG:[
      'Ajusta a regula√ß√£o pelo que prova funcionar.',
      'Mede externalidades e incentiva inova√ß√£o sustent√°vel.',
      'Expans√µes sociais via pilotos e avalia√ß√£o de impacto.'
    ]},
  {code:'B4', name:'Social-Democrata Cosmopolita', vec:{Ecom:30, Cult:70, Autor:40, Glob:70, Orto:-30, O:70, C:60, E:55, A:70, S:55},
    descP:'Bem-estar robusto, progressismo cultural, integra√ß√£o internacional. Justi√ßa e igualdade como deveres p√∫blicos.',
    descG:'Equil√≠brio entre impostos, servi√ßos e crescimento; pol√≠ticas testadas e ajust√°veis.',
    expP:[
      'Eixos: Estado (+Ecom), progressismo (+Cult), liberdades (+Autor), cosmopolitismo (+Glob).',
      'Filosofia: deveres de justi√ßa, universalismo de direitos.',
      'Pol√≠ticas: sa√∫de/educa√ß√£o universais, prote√ß√£o ao trabalho, coopera√ß√£o internacional.'
    ],
    expG:[
      'Benchmarks n√≥rdicos e metas claras.',
      'Foco em sustentabilidade fiscal e indicadores sociais.',
      'Corre√ß√µes iterativas conforme resultados.'
    ]},
  {code:'B5', name:'Nacional-Desenvolvimentista S-D', vec:{Ecom:50, Cult:30, Autor:10, Glob:-40, Orto:-10, O:55, C:65, E:50, A:60, S:60},
    descP:'Planejamento estatal e projeto nacional; valores comunit√°rios moderados.',
    descG:'Busca resultados industriais e de renda com pragmatismo estrat√©gico.',
    expP:[
      'Eixos: Estado (+Ecom), cultura moderada (+Cult), nacionalismo (‚àíGlob).',
      'Filosofia: bem comum, deveres c√≠vicos e coes√£o.',
      'Pol√≠ticas: conte√∫do local, cr√©dito direcionado, compras p√∫blicas estrat√©gicas.'
    ],
    expG:[
      'An√°lises de cadeia produtiva e metas exportadoras.',
      'Cl√∫steres e parques tecnol√≥gicos com governan√ßa por desempenho.',
      'Revis√µes peri√≥dicas de incentivos.'
    ]},
  {code:'B6', name:'Socialista Dem. Municipalista', vec:{Ecom:70, Cult:60, Autor:40, Glob:-10, Orto:-20, O:65, C:55, E:50, A:70, S:55},
    descP:'Democracia econ√¥mica local, cooperativas e igualdade. Solidariedade e participa√ß√£o.',
    descG:'Experimentos municipais e m√©tricas de bem-estar.',
    expP:[
      'Eixos: Estado (+Ecom), progressismo (+Cult), autonomia c√≠vica (+Autor), localismo leve (Glob ‚âà 0/‚àí).',
      'Filosofia: participa√ß√£o deliberativa e justi√ßa distributiva.',
      'Pol√≠ticas: or√ßamentos participativos, cooperativas e conselhos comunit√°rios.'
    ],
    expG:[
      'Pilotos de bairro com indicadores de sa√∫de e educa√ß√£o.',
      'Escalonamento do que funciona, transpar√™ncia radical.',
      'Plataformas p√∫blicas digitais para participa√ß√£o.'
    ]},
  {code:'B7', name:'Eco-Liberal', vec:{Ecom:-30, Cult:80, Autor:50, Glob:60, Orto:-30, O:80, C:55, E:55, A:65, S:55},
    descP:'Sustentabilidade com mercados, inova√ß√£o verde e direitos individuais.',
    descG:'Precifica√ß√£o de externalidades e regula√ß√£o ‚Äúsmart‚Äù.',
    expP:[
      'Eixos: mercado moderado (‚àíEcom), progressismo (+Cult), liberdades (+Autor), cosmopolitismo (+Glob).',
      'Filosofia: dever intergeracional e prud√™ncia cient√≠fica.',
      'Pol√≠ticas: mercados de carbono, propriedade ambiental, inova√ß√£o limpa.'
    ],
    expG:[
      'Design regulat√≥rio baseado em evid√™ncias.',
      'Pilotos tecnol√≥gicos e medi√ß√£o de emiss√µes/impactos.',
      'Revis√£o √°gil e accountability.'
    ]},
  {code:'B8', name:'Eco-Socialista', vec:{Ecom:60, Cult:80, Autor:10, Glob:30, Orto:-20, O:75, C:50, E:50, A:70, S:50},
    descP:'Transi√ß√£o ecol√≥gica liderada pelo Estado, justi√ßa clim√°tica e igualdade.',
    descG:'Prioriza mitiga√ß√£o/adapta√ß√£o efetivas com foco em impacto.',
    expP:[
      'Eixos: Estado (+Ecom), progressismo (+Cult), internacionalismo moderado (+Glob).',
      'Filosofia: dever moral ambiental e sobriedade.',
      'Pol√≠ticas: energia p√∫blica verde, tarifas sociais, empregos de transi√ß√£o.'
    ],
    expG:[
      'Indicadores de custo-efetividade clim√°tica.',
      'Metas claras de descarboniza√ß√£o e adapta√ß√£o.',
      'Revis√µes baseadas em resultados sociais.'
    ]},
  {code:'B9', name:'Conservador Liberal', vec:{Ecom:-50, Cult:-50, Autor:40, Glob:40, Orto:20, O:45, C:65, E:55, A:55, S:60},
    descP:'Tradi√ß√£o e mercado com liberdades civis; c√©tico a rupturas r√°pidas.',
    descG:'Preserva costumes com flexibilidade orientada a resultados.',
    expP:[
      'Eixos: mercado (‚àíEcom) e tradicionalismo (‚àíCult) com liberdades (+Autor).',
      'Filosofia: ordem social, deveres e virtudes c√≠vicas.',
      'Pol√≠ticas: liberdade religiosa, prud√™ncia regulat√≥ria, federalismo.'
    ],
    expG:[
      'Avalia reformas por efic√°cia e custo.',
      'Adapta tradi√ß√µes sem romper institui√ß√µes.',
      'Regula√ß√£o enxuta e responsiva.'
    ]},
  {code:'B10', name:'Conservador Comunitarista', vec:{Ecom:10, Cult:-60, Autor:-10, Glob:-20, Orto:40, O:40, C:65, E:50, A:65, S:60},
    descP:'Comunidade, fam√≠lia e deveres; ordem social org√¢nica.',
    descG:'Pol√≠tica pr√≥-comunidade guiada por resultados.',
    expP:[
      'Eixos: ligeiro estatismo (+Ecom), tradicionalismo (‚àíCult), localismo (‚àíGlob).',
      'Filosofia: virtudes de car√°ter e obriga√ß√µes m√∫tuas.',
      'Pol√≠ticas: suporte a fam√≠lias, associa√ß√µes civis, seguran√ßa proporcional.'
    ],
    expG:[
      'Avalia coes√£o: crime, solid√£o, capital social.',
      'Programas focados em v√≠nculos locais e mentoria.',
      'Recortes por evid√™ncia territorial.'
    ]},
  {code:'B11', name:'Democrata-Crist√£o (Ort.)', vec:{Ecom:-10, Cult:-20, Autor:30, Glob:10, Orto:70, O:50, C:70, E:50, A:70, S:65},
    descP:'S√≠ntese de valores ortodoxos com democracia e economia social de mercado.',
    descG:'Mesma linha com pragmatismo e avalia√ß√£o emp√≠rica.',
    expP:[
      'Eixos: economia social de mercado, tradicionalismo leve (‚àíCult), liberdades moderadas (+Autor), Orto alto (+).',
      'Teologia: foco na vontade de Deus e vida sacramental.',
      'Pol√≠ticas: subsidiariedade, prote√ß√£o social √† fam√≠lia, √©tica p√∫blica.'
    ],
    expG:[
      'Aplica√ß√£o prudencial de princ√≠pios conforme evid√™ncia.',
      'Parcerias p√∫blico-comunit√°rias.',
      'Foco em frutos sociais e dignidade da pessoa.'
    ]},
  {code:'B12', name:'Tradicionalista Ortodoxo', vec:{Ecom:20, Cult:-80, Autor:-30, Glob:-40, Orto:90, O:40, C:65, E:45, A:70, S:70},
    descP:'Enraizado na Tradi√ß√£o Ortodoxa: liturgia, sacramentos e vida virtuosa.',
    descG:'Mant√©m ethos ortodoxo com prud√™ncia na vida p√∫blica.',
    expP:[
      'Eixos: tradicionalismo forte (‚àíCult), comunitarismo e Orto muito alto (+).',
      '√änfase na vida eclesial, ascese e theosis.',
      'Pol√≠ticas: liberdade religiosa, fam√≠lia e solidariedade.'
    ],
    expG:[
      'Prud√™ncia e foco em frutos concretos.',
      'Caridade eficaz e coopera√ß√£o quando oportuno.',
      'Prioriza paz social e cuidado ao pr√≥ximo.'
    ]},
  {code:'B13', name:'Neoconservador Globalista', vec:{Ecom:-30, Cult:-20, Autor:-10, Glob:80, Orto:20, O:50, C:60, E:55, A:50, S:60},
    descP:'Ordem internacional, com√©rcio e defesa; dever de proteger.',
    descG:'Interven√ß√µes e alian√ßas calibradas por custo-benef√≠cio.',
    expP:[
      'Eixos: mercado moderado (‚àíEcom), conservador nos costumes (‚àíCult), globalista (+Glob).',
      'Filosofia: norma internacional e responsabilidade.',
      'Pol√≠ticas: alian√ßas, com√©rcio e dissuas√£o robusta.'
    ],
    expG:[
      'Crit√©rios: estabilidade regional, baixas civis e sustentabilidade.',
      'Limita nation-building ao que √© vi√°vel.',
      'Avalia√ß√µes p√≥s-a√ß√£o e aprendizado institucional.'
    ]},
  {code:'B14', name:'Populista Nacional de Direita', vec:{Ecom:-10, Cult:-70, Autor:-40, Glob:-80, Orto:30, O:40, C:55, E:60, A:45, S:55},
    descP:'Identidade nacional, lei e ordem, valores tradicionais.',
    descG:'Prote√ß√£o e coes√£o nacional guiadas por resultados.',
    expP:[
      'Eixos: tradicionalismo (‚àíCult), autoridade (‚àíAutor), nacionalismo (‚àíGlob).',
      'Filosofia: deveres patri√≥ticos e continuidade cultural.',
      'Pol√≠ticas: controle migrat√≥rio, reindustrializa√ß√£o, seguran√ßa p√∫blica firme.'
    ],
    expG:[
      'Prioriza redu√ß√£o de crime e desemprego.',
      'Protecionismo estrat√©gico com metas.',
      'Revis√µes peri√≥dicas conforme indicadores.'
    ]},
  {code:'B15', name:'Populista Nacional de Esquerda', vec:{Ecom:60, Cult:10, Autor:-30, Glob:-80, Orto:10, O:45, C:55, E:55, A:50, S:55},
    descP:'Soberania econ√¥mica, redistribui√ß√£o e identidade popular.',
    descG:'Foco em emprego, renda e prote√ß√£o dos vulner√°veis.',
    expP:[
      'Eixos: estatismo (+Ecom), leve progressismo (+Cult), nacionalismo (‚àíGlob).',
      'Filosofia: justi√ßa social nacional e autodetermina√ß√£o.',
      'Pol√≠ticas: nacionaliza√ß√£o seletiva, compras locais, controle de capitais.'
    ],
    expG:[
      'Metas de emprego/renda e avalia√ß√£o setorial.',
      'Tarifas tempor√°rias com revis√£o.',
      'Programas antifome e cr√©dito popular.'
    ]},
  {code:'B16', name:'Republicano C√≠vico', vec:{Ecom:-10, Cult:-10, Autor:20, Glob:10, Orto:20, O:55, C:65, E:55, A:60, S:60},
    descP:'Liberdade como n√£o-domina√ß√£o; virtudes c√≠vicas e regras constitucionais.',
    descG:'Reformas testadas por redu√ß√£o de corrup√ß√£o e aumento de engajamento.',
    expP:[
      'Eixos: equil√≠brio geral com liberalismo c√≠vico.',
      'Filosofia: rep√∫blica mista, deveres e direitos.',
      'Pol√≠ticas: transpar√™ncia, participa√ß√£o e educa√ß√£o c√≠vica.'
    ],
    expG:[
      'Mede accountability e confian√ßa institucional.',
      'Ajusta desenho institucional por evid√™ncia.',
      'Foco em imparcialidade do Estado.'
    ]},
  {code:'B17', name:'Tecno-Progressista', vec:{Ecom:-20, Cult:90, Autor:30, Glob:80, Orto:-50, O:85, C:60, E:55, A:55, S:55},
    descP:'Inova√ß√£o e direitos digitais como princ√≠pios; progresso humano.',
    descG:'Governan√ßa baseada em evid√™ncias e m√©tricas de impacto tecnol√≥gico.',
    expP:[
      'Eixos: inova√ß√£o (‚àíEcom), progressismo (+Cult), globalismo (+Glob).',
      'Filosofia: ci√™ncia, racionalidade p√∫blica e direitos.',
      'Pol√≠ticas: IA √©tica, pesquisa aberta e inclus√£o digital.'
    ],
    expG:[
      'Pilotos controlados e auditorias independentes.',
      'Itiner√°rios regulat√≥rios adaptativos.',
      'Crit√©rio: benef√≠cios l√≠quidos e mitiga√ß√£o de riscos.'
    ]},
  {code:'B18', name:'Tecno-Estatista', vec:{Ecom:40, Cult:80, Autor:-10, Glob:60, Orto:-40, O:80, C:60, E:50, A:50, S:55},
    descP:'Estado coordenando revolu√ß√µes tecnol√≥gicas para o bem p√∫blico.',
    descG:'Sandboxes, itera√ß√£o e auditorias emp√≠ricas.',
    expP:[
      'Eixos: estatismo (+Ecom), progressismo (+Cult), globalismo (+Glob).',
      'Filosofia: seguran√ßa, equidade e inclus√£o digital.',
      'Pol√≠ticas: infraestrutura e dados p√∫blicos, regula√ß√£o preventiva.'
    ],
    expG:[
      'Prototipagem regulat√≥ria com metas.',
      'Medi√ß√µes de risco/benef√≠cio e fairness.',
      'Ajustes cont√≠nuos por evid√™ncia.'
    ]},
  {code:'B19', name:'Libert√°rio de Esquerda', vec:{Ecom:-50, Cult:70, Autor:90, Glob:10, Orto:-40, O:80, C:45, E:60, A:65, S:50},
    descP:'Autonomia radical, antiautoritarismo e igualdade em costumes.',
    descG:'Comunidades volunt√°rias avaliadas pelo empoderamento real.',
    expP:[
      'Eixos: mercado (‚àíEcom) com forte anti-hierarquia (+Autor), progressismo (+Cult).',
      'Filosofia: n√£o domina√ß√£o e justi√ßa social volunt√°ria.',
      'Pol√≠ticas: cooperativas, descriminaliza√ß√£o, plataformas abertas.'
    ],
    expG:[
      'Mede emancipa√ß√£o e redu√ß√£o de coer√ß√£o.',
      'Pilotos comunit√°rios e governan√ßa distribu√≠da.',
      'Foco em direitos civis concretos.'
    ]},
  {code:'B20', name:'Anarco-Capitalista', vec:{Ecom:-90, Cult:30, Autor:100, Glob:20, Orto:-60, O:70, C:55, E:60, A:50, S:55},
    descP:'Propriedade privada, contratos e n√£o-agress√£o como axiomas.',
    descG:'Arranjos polic√™ntricos julgados por efici√™ncia observ√°vel.',
    expP:[
      'Eixos: mercado extremo (‚àíEcom) e anti-Estado (+Autor).',
      'Filosofia: direitos negativos e ordem emergente.',
      'Pol√≠ticas: privatiza√ß√£o ampla, moeda competitiva, arbitragem privada.'
    ],
    expG:[
      'Crit√©rios: seguran√ßa, custos e inova√ß√£o institucional.',
      'Mercados de reputa√ß√£o e seguros.',
      'Compara√ß√£o entre jurisdi√ß√µes volunt√°rias.'
    ]},
  {code:'B21', name:'Anarco-Comunal', vec:{Ecom:70, Cult:50, Autor:100, Glob:0, Orto:-30, O:75, C:45, E:60, A:70, S:50},
    descP:'Autogest√£o, horizontalidade e virtudes comunit√°rias.',
    descG:'Modelos comunais julgados por bem-estar real.',
    expP:[
      'Eixos: economia comum (+Ecom), antiautoritarismo (+Autor).',
      'Filosofia: √©tica das virtudes e democracia direta.',
      'Pol√≠ticas: bens comuns, cooperativas integrais, redes solid√°rias.'
    ],
    expG:[
      'Indicadores de sa√∫de, educa√ß√£o e coes√£o.',
      'Escalonamento do que prospera em rede.',
      'Transpar√™ncia e governan√ßa participativa.'
    ]},
  {code:'B22', name:'Centrista Pragm√°tico', vec:{Ecom:0, Cult:0, Autor:0, Glob:0, Orto:-10, O:55, C:60, E:50, A:60, S:60},
    descP:'Centro com princ√≠pios: equil√≠brio de direitos, deveres e virtudes.',
    descG:'‚ÄúO que funciona‚Äù acima de identidades ideol√≥gicas.',
    expP:[
      'Eixos: equil√≠brio nos quatro quadrantes pol√≠ticos.',
      'Filosofia: prud√™ncia, gradualismo e pactos.',
      'Pol√≠ticas: comiss√µes independentes e ajustes incrementais.'
    ],
    expG:[
      'Ciclo piloto-medir-ajustar.',
      'Benchmarking e compara√ß√£o internacional.',
      'Evita solu√ß√µes maximalistas.'
    ]},
  {code:'B23', name:'Humanista Secular Universalista', vec:{Ecom:-10, Cult:80, Autor:40, Glob:80, Orto:-90, O:80, C:55, E:50, A:65, S:60},
    descP:'Dignidade humana, direitos universais e cosmopolitismo; racionalismo e √©tica de princ√≠pios.',
    descG:'Humanismo por resultados: maximiza florescimento humano mensur√°vel.',
    expP:[
      'Eixos: leve mercado (‚àíEcom), progressismo (+Cult), liberdades (+Autor), globalismo (+Glob).',
      'Filosofia: ci√™ncia, laicidade e direitos humanos.',
      'Pol√≠ticas: coopera√ß√£o global, liberdade de consci√™ncia, ci√™ncia aberta.'
    ],
    expG:[
      'Crit√©rios: bem-estar, sa√∫de e educa√ß√£o global.',
      'Pol√≠ticas baseadas em evid√™ncias comparadas.',
      'Ajustes por m√©tricas de impacto.'
    ]},
];

// Subtipos: Principista vs Pragmatista
function buildCentroids(){
  const centroids = [];
  for(const b of baseProfiles){
    // Principista (P)
    const p = JSON.parse(JSON.stringify(b.vec));
    p.Epist = 60;  // racionalismo
    p.Etica = 60;  // deontologia
    p.Virt  = 80;  // +30 sobre ~50
    if(p.Orto > 0) p.Orto = clamp(p.Orto + 10, -100, 100);
    centroids.push({code:`${b.code}-P`, base:b.code, name:`${b.name} (Principista)`, vec:p, desc:b.descP, exp:b.expP, subtype:'P'});

    // Pragmatista (G)
    const g = JSON.parse(JSON.stringify(b.vec));
    g.Epist = -60; // empirismo
    g.Etica = -60; // consequencialismo
    g.Virt  = 60;  // +10 sobre ~50
    centroids.push({code:`${b.code}-G`, base:b.code, name:`${b.name} (Pragmatista)`, vec:g, desc:b.descG, exp:b.expG, subtype:'G'});
  }
  return centroids;
}
const centroids46 = buildCentroids();

// Distance weights
const weights = {
  Ecom:1, Cult:1, Autor:1, Glob:1, Orto:1,
  Epist:0.7, Etica:0.7, Virt:0.7,
  O:0.4, C:0.4, E:0.4, A:0.4, S:0.4
};

function distance(user, center){
  let sum = 0;
  for(const a of Object.keys(weights)){
    const w = weights[a] || 1;
    const diff = (user[a] ?? 0) - (center[a] ?? 0);
    sum += w * diff * diff;
  }
  return Math.sqrt(sum);
}

function classify(axesNorm){
  const V = {};
  for(const a of Object.keys(weights)){ V[a] = axesNorm[a] ?? 0; }
  let best = null, bestD = Infinity;
  for(const c of centroids46){
    const d = distance(V, c.vec);
    if(d < bestD){ bestD = d; best = c; }
  }
  return {best, bestD};
}

/* ------------------------- Digimon mapping (46) ------------------------ */
const digimonMap = {
  'B1-P': {name:'Chicomon', emoji:'üåê', why:'Soci√°vel e aberto a novas alian√ßas; energia otimista e pr√≥-inova√ß√£o combinam com cosmopolitismo liberal.'},
  'B1-G': {name:'Choromon', emoji:'‚öôÔ∏è', why:'Pragm√°tico e t√©cnico; foca em efici√™ncia e ajustes finos pr√≥-mercado.'},

  'B2-P': {name:'Zerimon', emoji:'üß≠', why:'Esp√≠rito livre e cooperativo, valoriza autonomia e la√ßos locais com princ√≠pios firmes.'},
  'B2-G': {name:'Paomon', emoji:'üè°', why:'Leal e comunit√°rio, prioriza solu√ß√µes de proximidade que funcionam no cotidiano.'},

  'B3-P': {name:'Leafmon', emoji:'üå±', why:'Crescimento com cuidado social; progressista e amig√°vel a redes de prote√ß√£o.'},
  'B3-G': {name:'Puwamon', emoji:'üïäÔ∏è', why:'Observador e adapt√°vel; calibra pol√≠ticas com dados e feedbacks r√°pidos.'},

  'B4-P': {name:'Nyokimon', emoji:'üå∏', why:'Abertura e interc√¢mbio; compromisso com bem-estar universal e integra√ß√£o.'},
  'B4-G': {name:'Pipimon', emoji:'üìä', why:'Ajusta rotas por evid√™ncia; equil√≠brio entre justi√ßa social e sustentabilidade fiscal.'},

  'B5-P': {name:'Tsubumon', emoji:'ü™®', why:'Semente robusta: foco em base produtiva e projeto nacional.'},
  'B5-G': {name:'Sunamon', emoji:'üèóÔ∏è', why:'Constr√≥i do ch√£o; metas industriais e pragmatismo estrat√©gico.'},

  'B6-P': {name:'Yuramon', emoji:'ü§ù', why:'Brota em comunidade; delibera√ß√£o e solidariedade locais.'},
  'B6-G': {name:'Pyonmon', emoji:'üîÅ', why:'Iterativo e leve; pilotos municipais e m√©tricas de bem-estar.'},

  'B7-P': {name:'Cocomon', emoji:'üåø', why:'Mercados verdes e inova√ß√£o ecol√≥gica com direitos individuais.'},
  'B7-G': {name:'Pitchmon', emoji:'üíß', why:'Navega fluxos (dados/externalidades) para solu√ß√µes ambientais eficazes.'},

  'B8-P': {name:'Popomon', emoji:'üå≥', why:'Justi√ßa clim√°tica e transforma√ß√£o coletiva; crescimento com sobriedade.'},
  'B8-G': {name:'Ketomon', emoji:'üß™', why:'Adapta√ß√£o t√©cnica: mitiga√ß√£o e transi√ß√£o guiadas por impacto.'},

  'B9-P': {name:'Relemon', emoji:'ü¶ä', why:'Prudente e contido; preserva virtudes e liberdades civis.'},
  'B9-G': {name:'Botamon', emoji:'üî•', why:'Cl√°ssico e confi√°vel; testando e ajustando sem rupturas bruscas.'},

  'B10-P': {name:'Tomorimon', emoji:'üèòÔ∏è', why:'√Çncora comunit√°ria: fam√≠lia, vizinhan√ßa e ordem social org√¢nica.'},
  'B10-G': {name:'Pafumon', emoji:'üéóÔ∏è', why:'Coes√£o e cuidado; pol√≠ticas locais guiadas por resultados.'},

  'B11-P': {name:'Curimon', emoji:'üïØÔ∏è', why:'Disciplina e sentido; f√©, dignidade e bem comum.'},
  'B11-G': {name:'YukimiBotamon', emoji:'‚ùÑÔ∏è', why:'Temperan√ßa e prud√™ncia; mesma dire√ß√£o, com avalia√ß√£o emp√≠rica.'},

  'B12-P': {name:'Mokumon', emoji:'üïäÔ∏è', why:'Simbologia de incenso: tradi√ß√£o viva, ascese e contempla√ß√£o.'},
  'B12-G': {name:'Puttimon', emoji:'üëº', why:'Miseric√≥rdia e prud√™ncia pastoral aplicadas √† vida p√∫blica.'},

  'B13-P': {name:'Keemon', emoji:'üõ∞Ô∏è', why:'Vigil√¢ncia e ordem internacional; responsabilidade de proteger.'},
  'B13-G': {name:'Pupumon', emoji:'üß≠', why:'Estabilidade por custo-benef√≠cio; pragmatismo estrat√©gico em alian√ßas.'},

  'B14-P': {name:'PetiMeramon', emoji:'üö®', why:'Firmeza e energia combativa: lei, ordem e identidade.'},
  'B14-G': {name:'Bommon', emoji:'üß±', why:'Assertivo e protetor; foco no que reduz crime e desemprego.'},

  'B15-P': {name:'Bombmon', emoji:'üí•', why:'Impulso mobilizador por soberania e justi√ßa social.'},
  'B15-G': {name:'Zurumon', emoji:'üß±', why:'Pragmatismo √°spero na defesa do povo e do trabalho.'},

  'B16-P': {name:'Yolkmon', emoji:'‚öñÔ∏è', why:'Equil√≠brio constitucional; institui√ß√µes como ‚Äúovo‚Äù da rep√∫blica.'},
  'B16-G': {name:'Pusumon', emoji:'üß©', why:'Aprimora sistemas com paci√™ncia e medi√ß√£o de integridade p√∫blica.'},

  'B17-P': {name:'Petitmon', emoji:'üöÄ', why:'Curioso e inventivo; aposta no progresso humano e direitos digitais.'},
  'B17-G': {name:'Kuramon', emoji:'üß†', why:'Lida com riscos digitais com m√©todo e avalia√ß√£o de impacto.'},

  'B18-P': {name:'Fufumon', emoji:'üè≠', why:'Forja tecnologia para o bem p√∫blico com coordena√ß√£o estatal.'},
  'B18-G': {name:'Dokimon', emoji:'üìú', why:'Audita, documenta e itera pol√≠ticas tecnol√≥gicas.'},

  'B19-P': {name:'Fusamon', emoji:'üîó', why:'Sinergias horizontais e autonomia radical com justi√ßa.'},
  'B19-G': {name:'Puyomon', emoji:'üß™', why:'Experimenta e aprende em redes volunt√°rias.'},

  'B20-P': {name:'Punimon', emoji:'üè¥', why:'M√≠nimo necess√°rio, anti-centraliza√ß√£o e liberdade contratual.'},
  'B20-G': {name:'Cotsucomon', emoji:'üìê', why:'Ordem espont√¢nea e regras claras testadas na pr√°tica.'},

  'B21-P': {name:'Pururumon', emoji:'üï∏Ô∏è', why:'Tecel√£o de redes de coopera√ß√£o e apoio m√∫tuo.'},
  'B21-G': {name:'Sakumon', emoji:'üåº', why:'Floresce quando o bem-estar real aumenta.'},

  'B22-P': {name:'Bubbmon', emoji:'ü´ß', why:'Prudente e centrado; media interesses e evita extremos.'},
  'B22-G': {name:'Torikaraballmon', emoji:'üçó', why:'Humor e pragmatismo cotidiano: o que funciona fica.'},

  'B23-P': {name:'Chibickmon', emoji:'üåç', why:'Cosmopolitismo gentil, direitos humanos e ci√™ncia p√∫blica.'},
  'B23-G': {name:'Fukamon', emoji:'üåä', why:'Mergulha em dados e coordena√ß√£o global por resultados.'},
};

/* ---------------------------- UI: Results ------------------------------ */
const axesGrid = document.getElementById('axesGrid');
const profileBlock = document.getElementById('profileBlock');
const topCurrentsDiv = document.getElementById('topCurrents');
const allCurrentsDiv = document.getElementById('allCurrents');
const resultsCard = document.getElementById('results');

function renderAxisCard(aKey, meta, value, isDir){
  const container = document.createElement('div');
  container.className='axis-card';
  const header = document.createElement('div');
  header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
  const title = document.createElement('div'); title.className='axis-title'; title.textContent = meta.title;
  const badge = document.createElement('div'); badge.innerHTML = `<span class="tag">${(Math.round(value*10)/10).toFixed(1)}</span>`;
  header.append(title, badge);
  const sub = document.createElement('div'); sub.className='axis-sub'; sub.textContent = meta.desc;

  const bar = document.createElement('div'); bar.className='meter'; bar.style.marginTop='8px';
  const center = document.createElement('div'); center.className='center'; if(!isDir){ center.style.display='none'; }
  const fill = document.createElement('div'); fill.className='fill';
  if(isDir){
    const perc = (value + 100) / 2; // 0..100
    fill.style.width = perc + '%';
    fill.style.background = value>=0 ? 'linear-gradient(90deg,#06b6d4,#22c55e)' : 'linear-gradient(90deg,#ef4444,#f59e0b)';
  }else{
    const perc = value; fill.style.width = perc + '%';
    fill.style.background = 'linear-gradient(90deg,#22c55e,#06b6d4)';
  }
  bar.appendChild(fill); bar.appendChild(center);
  container.append(header, sub, bar);
  return container;
}

function renderExpList(arr){
  const ul = document.createElement('ul'); ul.className='tight';
  (arr||[]).forEach(t=>{ const li=document.createElement('li'); li.innerHTML=t; ul.appendChild(li); });
  return ul;
}

function renderResults(axesNorm, currents, classification){
  profileBlock.innerHTML = '';
  const title = document.createElement('div');
  title.className='result-title';
  title.textContent = classification.best.name;
  const desc = document.createElement('div');
  desc.className='desc';
  desc.textContent = classification.best.desc;
  const meta = document.createElement('div');
  meta.style.marginTop='8px';
  meta.innerHTML = `<span class="tag">Dist√¢ncia: ${Math.round(classification.bestD)}</span>`;

  const expHeader = document.createElement('h3'); expHeader.textContent='Explica√ß√£o do perfil';
  const expList = renderExpList(classification.best.exp);

  // Digimon
  const digi = digimonMap[classification.best.code];
  const digimonHeader = document.createElement('h3'); digimonHeader.textContent='Seu Digimon correspondente';
  const digimonRow = document.createElement('div'); 
  if(digi){
    digimonRow.innerHTML = `
      <div class="digimon-badge"><span>${digi.emoji || '‚ú®'}</span><strong>${digi.name}</strong></div>
      <div class="small" style="margin-top:6px">${digi.why}</div>
    `;
  }else{
    digimonRow.innerHTML = `<div class="small">Sem mapeamento de Digimon para este perfil.</div>`;
  }

  profileBlock.append(title, desc, meta, digimonHeader, digimonRow, expHeader, expList);

  // Axes grid
  axesGrid.innerHTML='';
  for(const a of ['Ecom','Cult','Autor','Glob','Epist','Etica','Orto','Virt','O','C','E','A','S']){
    const isDir = axisMeta[a].type==='dir';
    const el = renderAxisCard(a, axisMeta[a], axesNorm[a], isDir);
    axesGrid.appendChild(el);
  }

  // Correntes: top 3
  const entries = Object.entries(currents).map(([k,v])=>[k, v]);
  entries.sort((a,b)=>b[1]-a[1]);
  topCurrentsDiv.innerHTML='';
  for(const [k,v] of entries.slice(0,3)){
    const box = document.createElement('div');
    box.className='card'; box.style.border='1px solid #1f2937';
    const inner = document.createElement('div'); inner.className='body';
    inner.innerHTML = `
      <div style="font-weight:700">${currentsMeta[k]} <span class="tag">${(v).toFixed(1)}</span></div>
      <div class="meter" style="margin-top:6px"><div class="fill" style="width:${v}%;background:linear-gradient(90deg,#0ea5e9,#7c3aed)"></div></div>
      <div class="small" style="margin-top:6px">C√≥digo: ${k}</div>
    `;
    box.appendChild(inner);
    topCurrentsDiv.appendChild(box);
  }
  allCurrentsDiv.innerHTML='';
  for(const [k,v] of entries){
    const row = renderAxisCard(k, {title:currentsMeta[k], desc:'Pontua√ß√£o (0‚Üí100)'}, v, false);
    allCurrentsDiv.appendChild(row);
  }

  resultsCard.style.display='';
}

/* ------------------------------ History -------------------------------- */
const LS_KEY_HISTORY = 'quiz46_history';
const LS_KEY_AUTOSAVE = 'quiz46_autoSave';
const historyList = document.getElementById('historyList');
const historyEmpty = document.getElementById('historyEmpty');

function loadAutoSavePref(){
  const chk = document.getElementById('chkAutoSave');
  let v = localStorage.getItem(LS_KEY_AUTOSAVE);
  // Ativado por padr√£o
  if(v === null || (v !== '0' && v !== '1')){ v = '1'; localStorage.setItem(LS_KEY_AUTOSAVE, '1'); }
  chk.checked = v === '1';
  chk.addEventListener('change', ()=> localStorage.setItem(LS_KEY_AUTOSAVE, chk.checked?'1':'0'));
}
loadAutoSavePref();

function getHistory(){
  try{
    const raw = localStorage.getItem(LS_KEY_HISTORY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    if(Array.isArray(arr)) return arr;
    return [];
  }catch(e){ return []; }
}
function setHistory(arr){
  try{ localStorage.setItem(LS_KEY_HISTORY, JSON.stringify(arr)); }catch(e){}
}
function saveToHistory(entry){
  const arr = getHistory();
  arr.unshift(entry);
  setHistory(arr);
  renderHistory();
}
function removeFromHistory(id){
  const arr = getHistory().filter(x=>x.id!==id);
  setHistory(arr);
  renderHistory();
}
function restoreResponses(entry){
  const resp = entry.responses || {};
  for(const it of items){
    const el = document.getElementById(it.code);
    if(el && typeof resp[it.code] !== 'undefined'){
      el.value = String(resp[it.code]);
    }
  }
  window.scrollTo({top:0, behavior:'smooth'});
}
function renderHistory(){
  const arr = getHistory();
  historyList.innerHTML = '';
  historyEmpty.style.display = arr.length ? 'none' : '';
  for(const h of arr){
    const card = document.createElement('div'); card.className='card';
    const body = document.createElement('div'); body.className='body';
    const dt = new Date(h.timestamp);
    const top3 = topCurrents(h.currents, 3).map(t=>`${t.name} (${t.value.toFixed(0)})`).join(', ');
    const digi = digimonMap[h.profile.code] || {};
    body.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap">
        <div>
          <div style="font-weight:700">${h.profile.name}</div>
          <div class="small">${dt.toLocaleString()} ‚Ä¢ Dist√¢ncia: ${Math.round(h.profile.distance)}</div>
          <div class="small">Top correntes: ${top3}</div>
          <div class="small">Digimon: <span class="digimon-badge"><span>${digi.emoji||'‚ú®'}</span><strong>${digi.name||'‚Äî'}</strong></span></div>
        </div>
        <div class="actions" style="margin:0">
          <button class="ghost" data-act="restore" data-id="${h.id}">Restaurar respostas</button>
          <button class="ghost" data-act="recalc" data-id="${h.id}">Recalcular</button>
          <button class="secondary" data-act="del" data-id="${h.id}">Excluir</button>
        </div>
      </div>
    `;
    card.appendChild(body);
    historyList.appendChild(card);
  }
  historyList.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-id');
      const act = btn.getAttribute('data-act');
      const entry = getHistory().find(x=>x.id===id);
      if(!entry) return;
      if(act==='restore'){ restoreResponses(entry); }
      if(act==='recalc'){
        restoreResponses(entry);
        doCalc();
        window.scrollTo({top:document.getElementById('results').offsetTop-10, behavior:'smooth'});
      }
      if(act==='del'){ removeFromHistory(id); }
    });
  });
}
function topCurrents(currObj, n=3){
  const arr = Object.entries(currObj||{}).map(([k,v])=>({code:k, name:currentsMeta[k], value:v}));
  arr.sort((a,b)=>b.value-a.value);
  return arr.slice(0,n);
}
renderHistory();

/* ------------------------------ Controls ------------------------------ */
document.getElementById('btnCalc').addEventListener('click', ()=> doCalc());
document.getElementById('btnExport').addEventListener('click', ()=>{
  const bundle = buildCurrentBundle();
  if(!bundle) return;
  downloadJSON(bundle.one, 'resultado-46perfils.json');
});
document.getElementById('btnRandom').addEventListener('click', ()=>{
  for(const it of items){ document.getElementById(it.code).value = String(1 + Math.floor(Math.random()*5)); }
});
document.getElementById('btnNeutral').addEventListener('click', ()=>{
  for(const it of items){ document.getElementById(it.code).value = '3'; }
});
document.getElementById('btnSaveHistory').addEventListener('click', ()=>{
  const bundle = buildCurrentBundle();
  if(!bundle) return;
  saveToHistory(bundle.one);
});
document.getElementById('btnExportHistory').addEventListener('click', ()=>{
  const arr = getHistory();
  downloadJSON(arr, 'historico-46perfils.json');
});
document.getElementById('btnClearHistory').addEventListener('click', ()=>{
  if(confirm('Deseja limpar todo o hist√≥rico?')){ setHistory([]); renderHistory(); }
});

function doCalc(){
  const bundle = buildCurrentBundle();
  if(!bundle) return;
  renderResults(bundle.axes, bundle.currents, bundle.cls);
  if(document.getElementById('chkAutoSave').checked){
    saveToHistory(bundle.one);
  }
  window.scrollTo({top:document.getElementById('results').offsetTop - 10, behavior:'smooth'});
}
function buildCurrentBundle(){
  const responses = getResponses();
  const {rawAxes, axesNorm, rawCurr, currNorm} = computeScores(responses);
  const cls = classify(axesNorm);
  const one = {
    id: String(Date.now()) + '_' + Math.random().toString(36).slice(2,7),
    responses, axesRaw:rawAxes, axes:axesNorm, currentsRaw:rawCurr, currents:currNorm,
    profile:{code:cls.best.code, name:cls.best.name, subtype:cls.best.subtype, distance:cls.bestD, base:cls.best.base},
    timestamp:new Date().toISOString()
  };
  return {one, axes:axesNorm, currents:currNorm, cls};
}
function downloadJSON(obj, filename){
  const blob = new Blob([JSON.stringify(obj,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}
</script>
</body>
</html>
